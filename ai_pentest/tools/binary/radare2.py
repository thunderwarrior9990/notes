"""Radare2 Analyzer Wrapper"""
import json
from typing import Dict, List, Any, Tuple, Optional
from ..base import ToolWrapper


class Radare2Analyzer(ToolWrapper):
    TOOL_NAME = "Radare2"
    BINARY_NAME = "r2"
    INSTALL_HINT = "Install with: apt install radare2"
    
    def build_command(self, target: str, commands: Optional[List[str]] = None, **kwargs) -> List[str]:
        cmd = [self.BINARY_NAME, "-q"]
        
        if commands:
            cmd.extend(["-c", ";".join(commands)])
        else:
            cmd.extend(["-c", "aaa;afl;iI;iz"])
        
        cmd.append(target)
        return cmd
    
    def parse_output(self, output: str, error: str) -> Tuple[List[Dict[str, Any]], Dict[str, Any]]:
        findings = []
        raw_data = {"info": {}, "functions": [], "strings": []}
        
        for line in output.split("\n"):
            if line.startswith("0x"):
                parts = line.split()
                if len(parts) >= 2:
                    raw_data["functions"].append({"addr": parts[0], "name": parts[-1]})
        
        return findings, raw_data
