"""Objdump Analyzer Wrapper"""
from typing import Dict, List, Any, Tuple, Optional
from ..base import ToolWrapper


class ObjdumpAnalyzer(ToolWrapper):
    TOOL_NAME = "Objdump"
    BINARY_NAME = "objdump"
    INSTALL_HINT = "Install with: apt install binutils"
    
    INSTALL_COMMANDS = {
        "apt": "sudo apt-get install -y binutils",
        "brew": "brew install binutils",
        "dnf": "sudo dnf install -y binutils",
    }
    
    REQUIRES_NETWORK = False
    OFFLINE_CAPABLE = True
    
    def build_command(self, target: str, disassemble: bool = True, headers: bool = True, **kwargs) -> List[str]:
        cmd = [self.BINARY_NAME]
        if disassemble:
            cmd.append("-d")
        if headers:
            cmd.append("-h")
        cmd.append(target)
        return cmd
    
    def parse_output(self, output: str, error: str) -> Tuple[List[Dict[str, Any]], Dict[str, Any]]:
        findings = []
        raw_data = {"sections": [], "functions": []}
        
        import re
        section_pattern = r"\s*\d+\s+(\.\w+)\s+"
        for match in re.finditer(section_pattern, output):
            raw_data["sections"].append(match.group(1))
        
        func_pattern = r"<(\w+)>:"
        for match in re.finditer(func_pattern, output):
            raw_data["functions"].append(match.group(1))
        
        return findings, raw_data
