"""Volatility3 Analyzer Wrapper"""
import json
from typing import Dict, List, Any, Tuple, Optional
from ..base import ToolWrapper


class Volatility3Analyzer(ToolWrapper):
    TOOL_NAME = "Volatility3"
    BINARY_NAME = "vol"
    INSTALL_HINT = "Install with: pip install volatility3"
    
    INSTALL_COMMANDS = {
        "pip": "pip install volatility3",
        "apt": "pip install volatility3",
    }
    
    REQUIRES_NETWORK = False
    OFFLINE_CAPABLE = True
    
    def build_command(self, target: str, plugin: str = "windows.info", **kwargs) -> List[str]:
        cmd = [self.BINARY_NAME, "-f", target, plugin, "-r", "json"]
        return cmd
    
    def parse_output(self, output: str, error: str) -> Tuple[List[Dict[str, Any]], Dict[str, Any]]:
        findings = []
        raw_data = {}
        
        try:
            raw_data = json.loads(output)
        except json.JSONDecodeError:
            raw_data = {"output": output}
        
        return findings, raw_data
