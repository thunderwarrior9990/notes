"""GDB Analyzer Wrapper"""
from typing import Dict, List, Any, Tuple, Optional
from ..base import ToolWrapper


class GdbAnalyzer(ToolWrapper):
    TOOL_NAME = "GDB"
    BINARY_NAME = "gdb"
    INSTALL_HINT = "Install with: apt install gdb"
    
    def build_command(self, target: str, commands: Optional[List[str]] = None, **kwargs) -> List[str]:
        cmd = [self.BINARY_NAME, "-batch"]
        
        if commands:
            for c in commands:
                cmd.extend(["-ex", c])
        else:
            cmd.extend(["-ex", "info functions", "-ex", "info variables"])
        
        cmd.append(target)
        return cmd
    
    def parse_output(self, output: str, error: str) -> Tuple[List[Dict[str, Any]], Dict[str, Any]]:
        findings = []
        raw_data = {"functions": [], "variables": []}
        
        for line in output.split("\n"):
            if "0x" in line and "()" in line:
                raw_data["functions"].append(line.strip())
        
        return findings, raw_data
