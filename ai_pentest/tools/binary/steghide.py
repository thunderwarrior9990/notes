"""Steghide Extractor Wrapper"""
from typing import Dict, List, Any, Tuple, Optional
from ..base import ToolWrapper


class SteghideExtractor(ToolWrapper):
    TOOL_NAME = "Steghide"
    BINARY_NAME = "steghide"
    INSTALL_HINT = "Install with: apt install steghide"
    
    INSTALL_COMMANDS = {
        "apt": "sudo apt-get install -y steghide",
        "brew": "brew install steghide",
    }
    
    REQUIRES_NETWORK = False
    OFFLINE_CAPABLE = True
    
    def build_command(self, target: str, password: str = "", extract: bool = True, info: bool = False, **kwargs) -> List[str]:
        if info:
            return [self.BINARY_NAME, "info", target]
        
        cmd = [self.BINARY_NAME, "extract", "-sf", target, "-p", password, "-f"]
        return cmd
    
    def parse_output(self, output: str, error: str) -> Tuple[List[Dict[str, Any]], Dict[str, Any]]:
        findings = []
        raw_data = {"extracted": False, "embedded_file": ""}
        
        if "wrote extracted data" in output.lower():
            raw_data["extracted"] = True
            findings.append(self._create_finding(
                title="Hidden Data Extracted",
                severity="medium",
                description="Steganographic content was extracted",
                evidence=output
            ))
        
        if "embedded file" in output.lower():
            import re
            match = re.search(r'embedded file "([^"]+)"', output)
            if match:
                raw_data["embedded_file"] = match.group(1)
        
        return findings, raw_data
